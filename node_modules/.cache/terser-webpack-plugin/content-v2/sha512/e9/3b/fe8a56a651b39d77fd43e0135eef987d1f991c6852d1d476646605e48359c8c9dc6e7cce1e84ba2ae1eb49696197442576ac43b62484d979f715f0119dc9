{"code":"!function(t){var n={};function r(e){if(n[e])return n[e].exports;var o=n[e]={i:e,l:!1,exports:{}};return t[e].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=t,r.c=n,r.d=function(t,n,e){r.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:e})},r.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},r.t=function(t,n){if(1&n&&(t=r(t)),8&n)return t;if(4&n&&\"object\"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(r.r(e),Object.defineProperty(e,\"default\",{enumerable:!0,value:t}),2&n&&\"string\"!=typeof t)for(var o in t)r.d(e,o,function(n){return t[n]}.bind(null,o));return e},r.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(n,\"a\",n),n},r.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},r.p=\"\",r(r.s=2)}([function(t,n,r){t.exports=function(){if(!t)var t={map:function(t,n){var r={};return n?t.map(function(t,e){return r.index=e,n.call(r,t)}):t.slice()},naturalOrder:function(t,n){return t<n?-1:t>n?1:0},sum:function(t,n){var r={};return t.reduce(n?function(t,e,o){return r.index=o,t+n.call(r,e)}:function(t,n){return t+n},0)},max:function(n,r){return Math.max.apply(null,r?t.map(n,r):n)}};var n=function(){var n=5,r=8-n,e=1e3;function o(t,r,e){return(t<<2*n)+(r<<n)+e}function i(t){var n=[],r=!1;function e(){n.sort(t),r=!0}return{push:function(t){n.push(t),r=!1},peek:function(t){return r||e(),void 0===t&&(t=n.length-1),n[t]},pop:function(){return r||e(),n.pop()},size:function(){return n.length},map:function(t){return n.map(t)},debug:function(){return r||e(),n}}}function u(t,n,r,e,o,i,u){this.r1=t,this.r2=n,this.g1=r,this.g2=e,this.b1=o,this.b2=i,this.histo=u}function a(){this.vboxes=new i(function(n,r){return t.naturalOrder(n.vbox.count()*n.vbox.volume(),r.vbox.count()*r.vbox.volume())})}function s(n,r){if(r.count()){var e=r.r2-r.r1+1,i=r.g2-r.g1+1,u=t.max([e,i,r.b2-r.b1+1]);if(1==r.count())return[r.copy()];var a,s,c,h,f=0,l=[],g=[];if(u==e)for(a=r.r1;a<=r.r2;a++){for(h=0,s=r.g1;s<=r.g2;s++)for(c=r.b1;c<=r.b2;c++)h+=n[o(a,s,c)]||0;l[a]=f+=h}else if(u==i)for(a=r.g1;a<=r.g2;a++){for(h=0,s=r.r1;s<=r.r2;s++)for(c=r.b1;c<=r.b2;c++)h+=n[o(s,a,c)]||0;l[a]=f+=h}else for(a=r.b1;a<=r.b2;a++){for(h=0,s=r.r1;s<=r.r2;s++)for(c=r.g1;c<=r.g2;c++)h+=n[o(s,c,a)]||0;l[a]=f+=h}return l.forEach(function(t,n){g[n]=f-t}),function(t){var n,e,o,i,u,s=t+\"1\",c=t+\"2\",h=0;for(a=r[s];a<=r[c];a++)if(l[a]>f/2){for(o=r.copy(),i=r.copy(),u=(n=a-r[s])<=(e=r[c]-a)?Math.min(r[c]-1,~~(a+e/2)):Math.max(r[s],~~(a-1-n/2));!l[u];)u++;for(h=g[u];!h&&l[u-1];)h=g[--u];return o[c]=u,i[s]=o[c]+1,[o,i]}}(u==e?\"r\":u==i?\"g\":\"b\")}}return u.prototype={volume:function(t){return this._volume&&!t||(this._volume=(this.r2-this.r1+1)*(this.g2-this.g1+1)*(this.b2-this.b1+1)),this._volume},count:function(t){var n=this.histo;if(!this._count_set||t){var r,e,i,u=0;for(r=this.r1;r<=this.r2;r++)for(e=this.g1;e<=this.g2;e++)for(i=this.b1;i<=this.b2;i++)u+=n[o(r,e,i)]||0;this._count=u,this._count_set=!0}return this._count},copy:function(){return new u(this.r1,this.r2,this.g1,this.g2,this.b1,this.b2,this.histo)},avg:function(t){var r=this.histo;if(!this._avg||t){var e,i,u,a,s=0,c=1<<8-n,h=0,f=0,l=0;for(i=this.r1;i<=this.r2;i++)for(u=this.g1;u<=this.g2;u++)for(a=this.b1;a<=this.b2;a++)s+=e=r[o(i,u,a)]||0,h+=e*(i+.5)*c,f+=e*(u+.5)*c,l+=e*(a+.5)*c;this._avg=s?[~~(h/s),~~(f/s),~~(l/s)]:[~~(c*(this.r1+this.r2+1)/2),~~(c*(this.g1+this.g2+1)/2),~~(c*(this.b1+this.b2+1)/2)]}return this._avg},contains:function(t){var n=t[0]>>r;return gval=t[1]>>r,bval=t[2]>>r,n>=this.r1&&n<=this.r2&&gval>=this.g1&&gval<=this.g2&&bval>=this.b1&&bval<=this.b2}},a.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map(function(t){return t.color})},size:function(){return this.vboxes.size()},map:function(t){for(var n=this.vboxes,r=0;r<n.size();r++)if(n.peek(r).vbox.contains(t))return n.peek(r).color;return this.nearest(t)},nearest:function(t){for(var n,r,e,o=this.vboxes,i=0;i<o.size();i++)((r=Math.sqrt(Math.pow(t[0]-o.peek(i).color[0],2)+Math.pow(t[1]-o.peek(i).color[1],2)+Math.pow(t[2]-o.peek(i).color[2],2)))<n||void 0===n)&&(n=r,e=o.peek(i).color);return e},forcebw:function(){var n=this.vboxes;n.sort(function(n,r){return t.naturalOrder(t.sum(n.color),t.sum(r.color))});var r=n[0].color;r[0]<5&&r[1]<5&&r[2]<5&&(n[0].color=[0,0,0]);var e=n.length-1,o=n[e].color;o[0]>251&&o[1]>251&&o[2]>251&&(n[e].color=[255,255,255])}},{quantize:function(c,h){if(!c.length||h<2||h>256)return!1;var f=function(t){var e,i=new Array(1<<3*n);return t.forEach(function(t){e=o(t[0]>>r,t[1]>>r,t[2]>>r),i[e]=(i[e]||0)+1}),i}(c);f.forEach(function(){});var l=function(t,n){var e,o,i,a=1e6,s=0,c=1e6,h=0,f=1e6,l=0;return t.forEach(function(t){(e=t[0]>>r)<a?a=e:e>s&&(s=e),(o=t[1]>>r)<c?c=o:o>h&&(h=o),(i=t[2]>>r)<f?f=i:i>l&&(l=i)}),new u(a,s,c,h,f,l,n)}(c,f),g=new i(function(n,r){return t.naturalOrder(n.count(),r.count())});function v(t,n){for(var r,o=t.size(),i=0;i<e;){if(o>=n)return;if(i++>e)return;if((r=t.pop()).count()){var u=s(f,r),a=u[0],c=u[1];if(!a)return;t.push(a),c&&(t.push(c),o++)}else t.push(r),i++}}g.push(l),v(g,.75*h);for(var p=new i(function(n,r){return t.naturalOrder(n.count()*n.volume(),r.count()*r.volume())});g.size();)p.push(g.pop());v(p,h);for(var b=new a;p.size();)b.push(p.pop());return b}}}().quantize,r=function(t){this.canvas=document.createElement(\"canvas\"),this.context=this.canvas.getContext(\"2d\"),this.width=this.canvas.width=t.width,this.height=this.canvas.height=t.height,this.context.drawImage(t,0,0,this.width,this.height)};r.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};var e=function(){};return e.prototype.getColor=function(t,n){return void 0===n&&(n=10),this.getPalette(t,5,n)[0]},e.prototype.getPalette=function(t,e,o){var i=function(t){var n=t.colorCount,r=t.quality;if(void 0!==n&&Number.isInteger(n)){if(1===n)throw new Error(\"colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()\");n=Math.max(n,2),n=Math.min(n,20)}else n=10;return void 0===r||Number.isInteger(r)?r=10:r<1&&(r=10),{colorCount:n,quality:r}}({colorCount:e,quality:o}),u=new r(t),a=function(t,n,r){for(var e=t,o=[],i=0,u=void 0,a=void 0,s=void 0,c=void 0,h=void 0;i<n;i+=r)a=e[0+(u=4*i)],s=e[u+1],c=e[u+2],(void 0===(h=e[u+3])||h>=125)&&(a>250&&s>250&&c>250||o.push([a,s,c]));return o}(u.getImageData().data,u.width*u.height,i.quality),s=n(a,i.colorCount);return s?s.palette():null},e.prototype.getColorFromUrl=function(t,n,r){var e=document.createElement(\"img\"),o=this;e.addEventListener(\"load\",function(){var i=o.getPalette(e,5,r);n(i[0],t)}),e.src=t},e.prototype.getImageData=function(t,n){var r=new XMLHttpRequest;r.open(\"GET\",t,!0),r.responseType=\"arraybuffer\",r.onload=function(){if(200==this.status){var t=new Uint8Array(this.response);e=t.length;for(var r=new Array(e),e=0;e<t.length;e++)r[e]=String.fromCharCode(t[e]);var o=r.join(\"\"),i=window.btoa(o);n(\"data:image/png;base64,\"+i)}},r.send()},e.prototype.getColorAsync=function(t,n,r){var e=this;this.getImageData(t,function(t){var o=document.createElement(\"img\");o.addEventListener(\"load\",function(){var t=e.getPalette(o,5,r);n(t[0],this)}),o.src=t})},e}()},,function(t,n,r){\"use strict\";r.r(n);var e=r(0),o=r.n(e);const i={r:0,b:0,g:0},u={r:1,b:1,g:1};function a(t){let{amount:n,rgb:{r:r,g:e,b:o}}=t;const i=t=>t*(100+n)/100;return{r:r=(r=i(r))<1?r:1,g:e=(e=i(e))<1?e:1,b:o=(o=i(o))<1?o:1}}window.onmessage=async t=>{const{data:n}=t,{pluginMessage:r}=n,{imageBytes:e,width:s,height:c}=r,{img:h,dominantColor:f,palette:l}=await function(t){const n=document.getElementById(\"main\"),r=new Blob([t],{type:\"image/jpeg\"}),e=window.URL.createObjectURL(r);return n.setAttribute(\"src\",e),new Promise(t=>{n.onload=function(){const r=new o.a,e=r.getColor(n,1),i={r:e[0]/255,g:e[1]/255,b:e[2]/255},u=r.getPalette(n,5,1).map(t=>({r:t[0]/255,g:t[1]/255,b:t[2]/255}));t({img:n,dominantColor:i,palette:u})}})}(e);h.setAttribute(\"width\",s),h.setAttribute(\"height\",c);const g=function(t){const{r:n,g:r,b:e}=t;let o,s;return(s=.2126*(o=(o=[n,r,e]).map(t=>t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)))[0]+.7152*o[1]+.0722*o[2])>.179?[i,a({rgb:t,amount:-80})]:[u,a({rgb:t,amount:180})]}(f);window.parent.postMessage({pluginMessage:{dominantColor:f,suggestedTextColors:g,palette:l}},\"*\")}}]);","extractedComments":[]}